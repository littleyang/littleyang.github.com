<!DOCTYPE html>
<html itemscope itemtype="http://schema.org/Blog">
<head>
    <meta charset="UTF-8" />
    <meta name="application-name" content="Looking-Glass" />
    <meta name="author" content="LittleYang" />
    <meta name="generator" content="Jekyll 0.12.0" />
    <meta name="description" content="本文采用 Creative Commons Attribution-ShareAlike 3.0 Unported 授权。" />
    <meta name="keywords" content="" />

    <meta itemprop="name" content="版本控制系统入门 (II). Git">
    <meta itemprop="description" content="本文采用 Creative Commons Attribution-ShareAlike 3.0 Unported 授权。">
    <meta itemprop="image" content="" />

    <title>版本控制系统入门 (II). Git</title>

    <link rel="alternate" type="application/atom+xml" href="/atom.xml" />
    <link rel="icon" type="image/vnd.microsoft.icon" href="/favicon.ico" sizes="57x57" />

    <link rel="author" type="text/html" href="https://plus.google.com/100974147585154622588/about" />
    <link rel="license" type="text/html" href="http://creativecommons.org/licenses/by-sa/3.0/" />

    <!-- Google Web Fonts (not in use) -->
    <!-- link rel='stylesheet' type='text/css' href='http://fonts.googleapis.com/css?family=Droid+Sans' / -->

    <link rel="stylesheet" type="text/css" href="/~css/main.css" media="all" />
    <link rel="stylesheet" type="text/css" href="/~css/mobile.css" media="all and (max-width:1023px)" />

    <!-- Pygments -->
    <link rel="stylesheet" type="text/css" href="/~css/pygments.css" media="all" />

    <!-- Highlight.js -->
    <link rel="stylesheet" href="/~css/tomorrow-night.min.css">
    <script src="/~js/highlight.pack.js"></script>
    <!-- script>hljs.initHighlightingOnLoad();</script -->

    <!-- jQuery & Galleria -->
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.js"></script>
    <script src="/~plugins/galleria/galleria-1.2.8.min.js"></script>

    <!-- MathJax (not in use) -->
    <!-- script type="text/x-mathjax-config">
        MathJax.Hub.Config({
          tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}
        });
    </script>
    <script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script -->

    <!-- ShareThis (not in use) -->
    <!-- script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
    <script type="text/javascript">stLight.options({publisher: "9aabed9c-ac3f-4f96-8f5a-8e7a27307543"}); </script -->

    <!-- Google Analytics -->
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-27086900-1']);
        _gaq.push(['_setDomainName', '.soimort.org']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

    <script type="text/javascript" src="/~js/main.js"></script>

</head>

<body>
    <!-- load background image (must be put in body) -->
    <script type="text/javascript">
        document.body.style.backgroundImage = "url('http://i.imgur.com/0eQ5v.jpg')";
    </script>

    <nav id="navBarTop">
        <ul class="navBarListLeft">
            <li><a href="/"><img src="/~images/home.png" alt="home" title="Home" class="navDock" height="24" /></a></li>
            <li><a href="/atom.xml" target="_blank"><img src="/~images/feed.png" alt="feed" title="Feed" class="navDock" height="24" /></a></li>
        </ul>

        <ul class="navBarListRight">
            <li style="position: relative; top: -5px"><b>LittleYang</b> on </li>
            <!-- Google+ --><li><a href="https://plus.google.com/107586052733788098083/" target="_blank"><img src="https://ssl.gstatic.com/images/icons/gplus-32.png" alt="gplus" title="Google+" class="navDock" height="24" /></a></li>
            <!-- Twitter --><li><a href="https://twitter.com/soimort" target="_blank"><img src="/~images/twitter.png" alt="twitter" title="Twitter" class="navDock" height="24" /></a></li>
            <!-- Facebook --><!-- li><a href="https://www.facebook.com/soimort" target="_blank"><img src="/~images/facebook.png" alt="facebook" title="Facebook" class="navDock" height="24" /></a></li -->
            <!-- deviantArt --><li><a href="http://soimort.deviantart.com" target="_blank"><img src="/~images/deviantart.png" alt="deviantart" title="deviantART" class="navDock" height="24" /></a></li>
            <!-- GitHub --><li><a href="http://github.com/soimort" target="_blank"><img src="/~images/github.png" alt="github" title="GitHub" class="navDock" height="24" /></a></li>
        </ul>
    </nav>

    <nav id="navBarBottom">
        <div class="navBarListLeft">
            <div style="position: relative; top: 4px; width: 60%">
                © 2013 <a href="http://www.google.com" target="_blank"><b>Little Yang</b></a>. Under the <a href="http://creativecommons.org/licenses/by-sa/3.0/" target="_blank"><b>CC BY-SA 3.0 License</b></a>.
            </div>
        </div>

        <div class="navBarListRight">
            <div style="position: relative; top: 4px; right: 0">
                 |Powered by <a href="http://jekyllrb.com/" target="_blank"><b>Jekyll</b></a>
            </div>
        </div>
    </nav>

    <div id="divTitle">
    <h1>版本控制系统入门 (II). Git</h1>
    <p><div class="g-plusone" data-size="medium" data-annotation="none"></div></p>
    <p><b>30 Dec 2011</b>, by <b>Mort</b></p>
    <p>本文采用 Creative Commons Attribution-ShareAlike 3.0 Unported 授权。</p>
    <div id="divTitleNav">
        <a href="/"><img src="/~images/left-arrow.png" class="navDock" /></a>
    </div>
</div>

<div id="divPost">
    <article id="articlePost">
        <h2>0. 版本控制：从集中式到分布式</h2>
<p>与集中式版本控制系统的客户端-服务器（Client/Server, C/S）模式相异，分布式版本控制系统（Distributed Version Control System, DVCS）采取一种端对端（peer-to-peer, P2P）的对等模式。每个节点（peer）的工作拷贝均是一个完全等效的仓储，而非仅有唯一的一个供客户端同步的“中心”仓储。分布式版本控制通过节点之间交换补丁（patch）来实现。这使得它与集中式版本控制系统存在着许多本质上的差别：</p>
<ul>
	<li>不存在一份默认的、权威的“标准”代码拷贝；只有相互之间对等的工作拷贝。</li>
	<li>常规的操作（如提交、查看历史和回滚更改）速度非常之快，因为不需要同存放中心仓储的远程服务器进行通信。仅仅当对其他节点推入（push）或拖出（pull）变更时才需要网络通信。</li>
	<li>每一份工作拷贝均是一份有效的完整代码库，其功能与原仓储完全等同。它包含变化的全部历史，可以用以恢复任意的历史数据。</li>
</ul>
<p>分布式版本控制还具备以下若干重要的特征：</p>
<ul>
	<li>可以同时存在多个“中心”仓储。</li>
	<li>来自不同仓储的代码依据信任网络（web of trust）进行合并，一些主要考虑的因素包括：历史贡献和修改代码的质量。</li>
	<li>允许存在不同的开发模型。例如：开发/发布分支模型或者类似于指挥官/副官的组织结构模型。这在大型的软件项目中可以形成高效的责任机制。</li>
	<li>“副官”是拥有动态决定哪些分支用于合并的特权的项目成员。</li>
	<li>在大部分操作中，无需网络连接。</li>
	<li>提交变更或从远程仓储获取变更时，允许单独的一组“同步”操作。</li>
	<li>因为变更是单独存放在小的数据单元里的，自动地从不同版本中合并变化变得有可能，即使变化已经被添加到了两个或更多的分支当中。</li>
	<li>典型的分布式版本控制系统基于存储目录树，用以取代过去的独立文件存储。这使得改变文件的名字和位置、移动代码的某一部分到不同的文件中均变得更加容易了。</li>
</ul>
<h2>1. Git基本操作</h2>
<h3>1.1. 用户设置</h3>
<p>设置全局用户名与邮箱：<br />
<code>$ git config --global user.name "Firstname Lastname"</code><br />
<code>$ git config --global user.email your_email</code><code>@youremail.com</code></p>
<h3>1.2. 获取一个git库并创建一个补丁</h3>
<p>克隆远程git库到本地当前路径下的hello-world目录：<br />
<code>$ git clone git://github.com/git/hello-world.git hello-world</code></p>
<p><code>$ cd hello-world</code><br />
<code>$ (edit files)</code><br />
向本地git库中添加文件：<br />
<code>$ git add (files)</code></p>
<p>从本地git库中删除文件：<br />
<code>$ git rm (files)</code><br />
<code>$ git rm -r (directories)</code></p>
<p>修改本地git库中文件后，查看所更改的内容：<br />
<code>$ git diff --cached</code></p>
<p>提交更改到本地git库：<br />
<code>$ git commit -m 'Explain what I changed'</code></p>
<p>也可直接添加所有文件，并提交更改到本地git库：<br />
<code>$ git commit -a -m 'Explain what I changed'</code></p>
<p>创建一个补丁（patch）：<br />
<code>$ git format-patch origin/master</code></p>
<h3>1.3. 创建一个本地git库</h3>
<p>将一个现有的本地目录初始化为git库：<br />
<code>$ cd (project-directory)</code><br />
<code>$ git init</code></p>
<p><code>$ (add some files)</code><br />
添加当前目录中所有文件到git库：<br />
<code>$ git add .</code></p>
<p>提交更改到本地git库：<br />
<code>$ git commit -m 'Initial commit'</code></p>
<h3>1.4. 团队协作</h3>
<p>获取远程git库的最新版本，且合并到本地（这实际上包含git fetch和git merge）：<br />
<code>$ git pull</code></p>
<p>提交所有更改到远程git库：<br />
<code>$ git push</code></p>
<h3>1.5. 查看日志</h3>
<p>查看当前git库状态：<br />
<code>$ git status</code></p>
<p>显示所有提交日志：<br />
<code>$ git log</code></p>
<p>显示所有提交日志，以及每次提交的具体变化：<br />
<code>$ git log -p</code></p>
<h2>2. 项目托管平台的使用（以GitHub为例）</h2>
<h3>2.1. GitHub初始设置</h3>
<p>检查SSH密钥是否存在，若已存在，则备份旧的密钥并删除：<br />
<code>$ cd ~/.ssh</code><br />
<code>$ ls</code><br />
<code>config id_rsa id_rsa.pub known_hosts</code><br />
<code>$ mkdir key_backup</code><br />
<code>$ cp id_rsa* key_backup</code><br />
<code>$ rm id_rsa*</code></p>
<p>设置自己的密钥短语（passphrase），生成一对新的SSH密钥：<br />
<code>$ ssh-keygen -t rsa -C "your_email</code><code>@youremail.com"</code></p>
<p>添加SSH公钥到GitHub：<br />
在GitHub页面上点击Account Settings &gt; <span class="caps">SSH</span> Public Keys &gt; Add another public key，添加id_rsa.pub文件里的所有内容（SSH公钥）。</p>
<p>确认SSH认证：<br />
<code>$ ssh -T git</code><code>@github.com</code><br />
输入yes确认连接，并输入自己的密码短语。显示如下：<br />
<code>Hi username! You've successfully authenticated, but GitHub does not provide shell access.</code><br />
表明已正确认证SSH密钥。</p>
<p><strong>注意</strong> 如果以后修改了SSH密钥后提示如下错误信息：</p>
<pre><code>Agent admitted failure to sign using the key.
Permission denied (publickey).
fatal: The remote end hung up unexpectedly</code></pre>
<p>你需要手动添加自己的SSH密钥：<br />
<code>$ ssh-add ~/.ssh/id_rsa</code></p>
<p>在本地设置自己的全局用户名与邮箱（同前）：<br />
<code>$ git config --global user.name "Firstname Lastname"</code><br />
<code>$ git config --global user.email your_email</code><code>@youremail.com</code></p>
<p>允许单独地为某个git库设置另外的用户名与邮箱：<br />
<code>$ cd my_other_repo</code><br />
<code>$ git config user.name "Different Name"</code><br />
<code>$ git config user.email your_email</code><code>@youremail.com</code></p>
<p>设置令牌（token）：一些工具并非使用SSH连接GitHub。为了使这些工具能够正常工作，需要找到并设置自己的API令牌。<br />
在GitHub页面上点击Account Settings &gt; Account Admin，找到自己的API Token。<br />
设置全局用户名和令牌：<br />
<code>$ git config --global github.user username</code><br />
<code>$ git config --global github.token 0123456789yourf0123456789token</code></p>
<p><strong>注意</strong> 如果更改了GitHub的账号密码，一个新的令牌将会被生成，需要重新在命令行下设置。</p>
<h3>2.2. 创建一个新的仓储（repository, repo）</h3>
<p>在GitHub页面上点击New Repository，创建一个新的仓储。</p>
<p>在本地创建一个git库，并新建一个README文件：<br />
<code>$ mkdir ~/Hello-World</code><br />
<code>$ cd ~/Hello-World</code><br />
<code>$ git init</code><br />
<code>$ touch README</code></p>
<p>添加README文件并提交到本地git库：<br />
<code>$ git add README</code><br />
<code>$ git commit -m 'first commit'</code></p>
<p>添加远程端“origin”，提交所有更改到远程端“origin”的master分支：<br />
<code>$ git remote add origin git</code><code>@github.com:username/Hello-World.git</code><br />
<code>$ git push -u origin master</code></p>
<p>查看远程端信息：<br />
<code>$ git remote -v</code></p>
<h3>2.3. 分叉（fork）一个已有的仓储</h3>
<p>在GitHub项目页面上点击&quot;Fork&quot;。</p>
<p>复制远程git库到本地（分叉产生的仓储自动为“origin”远程端）：<br />
<code>$ git clone git</code><code>@github.com:username/Spoon-Knife.git</code></p>
<p>添加远程端“upstream”，用于追踪上游仓储：<br />
<code>$ cd Spoon-Knife</code><br />
<code>$ git remote add upstream git://github.com/octocat/Spoon-Knife.git</code><br />
<code>$ git fetch upstream</code></p>
<p>提交所有更改到远程端“origin”的master分支：<br />
<code>$ git push origin master</code></p>
<p>获取来自上游仓储（远程端“upstream”）的更改：<br />
<code>$ git fetch upstream</code></p>
<p>将上游（远程端“upstream”）的master分支合并到本地：<br />
<code>$ git merge upstream/master</code></p>
<p>也可直接获取来自上游仓储的更改且合并到本地：<br />
<code>$ git pull upstream</code></p>
<h3>2.4. 使用分支（branch）进行工作</h3>
<p>创建一个新的分支：<br />
<code>$ git branch mybranch</code></p>
<p>使用分支进行工作：<br />
<code>$ git checkout mybranch</code></p>
<p>也可直接创建一个新的分支并使用其工作：<br />
<code>$ git checkout -b mybranch</code></p>
<p>在不同分支之间切换：<br />
<code>$ git checkout master</code><br />
<code>$ git checkout mybranch</code></p>
<h3>2.5. 三种常见的Git地址</h3>
<ol>
	<li>Git：
	<ul>
		<li><code>git</code> @ <code>github.com:username/Hello-World.git</code></li>
	</ul></li>
	<li>HTTPS（443），用于Git默认端口（9418）受限时：
	<ul>
		<li><code>https://soimort</code><code>@github.com/username/Hello-World.git</code></li>
	</ul></li>
	<li>Git Read-Only，用于没有写权限的远程git库：
	<ul>
		<li><code>git://github.com/username/Hello-World.git</code></li>
	</ul></li>
</ol>
<h2>3. 其他流行的分布式版本控制系统</h2>
<h3>3.1. Mercurial</h3>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Mercurial">[Wikipedia: Mercurial]</a></li>
	<li><a href="http://mercurial.selenic.com/">[Mercurial]</a></li>
</ul>
<h3>3.2. Bazaar</h3>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Bazaar_(software)">[Wikipedia: Bazaar]</a></li>
	<li><a href="http://bazaar.canonical.com/en/">[Bazaar]</a></li>
</ul>
<h2>参考链接</h2>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Distributed_Version_Control_System">[Wikipedia: <span class="caps">DVCS</span>]</a></li>
</ul>
<ul>
	<li><a href="http://en.wikipedia.org/wiki/Git_(software)">[Wikipedia: Git]</a></li>
	<li><a href="http://git-scm.com/">[Git]</a></li>
	<li><a href="http://book.git-scm.com/book.pdf" title="PDF format">Git Community Book</a></li>
	<li><a href="http://git.or.cz/index.html">Git – Fast Version Control System</a></li>
	<li><a href="http://hoth.entp.com/output/git_for_designers.html">Git for Designers</a></li>
	<li><a href="http://eagain.net/articles/git-for-computer-scientists/">Git for Computer Scientists</a></li>
	<li><a href="http://progit.org/book/">Pro Git</a></li>
	<li><a href="http://progit.org/book/zh/">Pro Git（简体中文）</a></li>
	<li><a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/">Git Magic</a></li>
	<li><a href="http://www-cs-students.stanford.edu/~blynn/gitmagic/intl/zh_cn/">Git Magic（简体中文）</a></li>
	<li><a href="http://ftp.newartisans.com/pub/git.from.bottom.up.pdf" title="PDF format">Git from the bottom up</a></li>
	<li><a href="http://blog.enjoyrails.com/2008/12/31/git%E4%B8%80%E5%88%86%E9%92%9F%E6%95%99%E7%A8%8B/">Git一分钟教程（简体中文）</a></li>
</ul>
<ul>
	<li><a href="http://help.github.com/">GitHub Help</a></li>
	<li><a href="http://help.github.com/win-set-up-git/">GitHub Help &#8211; Set Up Git</a></li>
	<li><a href="http://help.github.com/create-a-repo/">GitHub Help &#8211; Create A Repository</a></li>
	<li><a href="http://help.github.com/fork-a-repo/">GitHub Help &#8211; Fork A Repository</a></li>
</ul>
    </article>
    
    
    <article id="articlePost" style="padding-bottom: 0">
        <div id="divDisqus">
            <div id="disqus_thread"></div>
            <script type="text/javascript">
                var disqus_shortname = 'soimort';
                
                var disqus_url = 'http://www.soimort.org/tech-blog/2011/12/30/scm-2_zh.html';
                
                
                (function() {
                    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                    dsq.src = 'http://' + disqus_shortname + '.disqus.com/embed.js';
                    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
                })();
            </script>
            <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
            <a href="http://disqus.com" class="dsq-brlink">blog comments powered by <span class="logo-disqus">Disqus</span></a>
        </div>
    </article>
    
</div>


</body>
</html>
